%! TEX program = luatex

\documentclass[a4paper,twoside]{article}

\usepackage{emoji}
\usepackage{fontspec}
\usepackage[margin=1in]{geometry}
\usepackage{fancyhdr}
\usepackage{xcolor}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{float}
\usepackage{tikz}
\usepackage[]{todonotes}
\usepackage{titling}
\usepackage{tocloft}
\usepackage{titletoc}
\usepackage{adjustbox}
\usepackage{etoolbox}
\usepackage[most]{tcolorbox}
\usepackage{endnotes}
\usepackage[normalem]{ulem}
\usepackage{soul}
\usepackage[bottom,hang]{footmisc}
\usepackage[none]{hyphenat}
\usepackage{titlesec}
\usepackage{datetime}
\usepackage{minted2}
\usepackage[
  contentBlocks,
  rawAttribute,
  texMathDollars,
  pipeTables,
  tableCaptions,
  fencedCode,
  strikeThrough,
  superscripts,
  subscripts,
  inlineNotes,
  definitionLists,
  hybrid,
  taskLists,
]{markdown}



\settimeformat{ampmtime}
\sloppy

\setlength{\marginparwidth}{1.8cm}

\newcommand{\todoComment}[1]{
  \todo[
    % fancyline,
    linecolor=black!10,
    bordercolor=black!10,
    textcolor=black!50,
    backgroundcolor=black!3,
    tickmarkheight=0.2cm,
    size=\scriptsize
  ]{#1}
}
% ============================================================
% COLOR DEFINITIONS
% ============================================================

% Code Block Colors
\definecolor{terminalCommandBg}{RGB}{232,234,237}
\definecolor{terminalCommandFg}{RGB}{0,92,197}

% Inline Code Colors
\definecolor{inlineCodeBg}{RGB}{247,247,247}
\definecolor{inlineCodeFg}{RGB}{50,50,50}

% Quote Colors
\definecolor{quoteBg}{RGB}{247,247,247}
\definecolor{quoteBorder}{RGB}{175,175,175}

% Footnote Colors
\definecolor{footnoteRuleColor}{RGB}{150,150,150}
\definecolor{footnoteNumColor}{RGB}{150,150,150}

% Keyboard Shortcut Colors
\definecolor{keyBg}{RGB}{247,247,247}
\definecolor{keyBorder}{RGB}{161,161,161}
\definecolor{keyBottomBorder}{RGB}{102,102,102}

% Alert Box Colors
\definecolor{alertNoteBg}{RGB}{221,244,255}
\definecolor{alertNoteBorder}{RGB}{84,174,255}
\definecolor{alertTipBg}{RGB}{223,251,223}
\definecolor{alertTipBorder}{RGB}{87,171,90}
\definecolor{alertImportantBg}{RGB}{233,221,255}
\definecolor{alertImportantBorder}{RGB}{165,113,255}
\definecolor{alertWarningBg}{RGB}{255,237,185}
\definecolor{alertWarningBorder}{RGB}{228,160,0}
\definecolor{alertCautionBg}{RGB}{255,226,221}
\definecolor{alertCautionBorder}{RGB}{255,103,79}

% Container Box Colors
\definecolor{boxBg}{RGB}{250,250,250}
\definecolor{boxBorder}{RGB}{200,200,200}

% Miscellaneous Colors
\definecolor{highlightBg}{RGB}{255,255,152}
\definecolor{codeHighlightBg}{RGB}{223,240,216}

% Title Header Colors (for mode 2)
\definecolor{titleBoxBg}{RGB}{252,252,252}
\definecolor{titleBoxFrame}{RGB}{230,230,230}
\definecolor{titleMainText}{RGB}{26,26,26}
\definecolor{titleSubText}{RGB}{77,77,77}

% ============================================================

\newtcbox{\inlinecode}{
  enhanced,
  on line,
  arc=2pt,
  colback=inlineCodeBg,
  colframe=inlineCodeBg,
  boxrule=0pt,
  left=4pt,
  right=4pt,
  top=2pt,
  bottom=2pt,
  boxsep=0pt,
  before upper={\ttfamily\color{inlineCodeFg}},
}

\newcommand{\mdstrikethrough}[1]{\sout{#1}}
\newcommand{\mdhighlight}[1]{\colorbox{highlightBg}{#1}}

% ============================================================
% TCOLORBOX ENVIRONMENTS
% ============================================================

\newtcolorbox{mdblockquote}{
  enhanced,
  frame hidden,
  colback=quoteBg,
  borderline west={1pt}{0pt}{quoteBorder},
  left=10pt,
  right=10pt,
  top=8pt,
  bottom=8pt,
  boxsep=0pt,
  sharp corners
}

% Functional alert box generator
\newcommand{\createalertbox}[4]{
  \newtcolorbox{#1}{
    enhanced,
    breakable,
    colback=#2,
    colframe=#3,
    boxrule=1pt,
    left=13pt,
    right=10pt,
    top=26pt,
    bottom=10pt,
    boxsep=0pt,
    sharp corners,
    borderline west={3pt}{0pt}{#3},
    overlay={\node[anchor=north west,font=\bfseries,text=#3] at ([xshift=10pt,yshift=-8pt]frame.north west) {#4};}
  }
}

% Create all alert boxes using the functional approach
\createalertbox{mdalertnote}{alertNoteBg}{alertNoteBorder}{NOTE}
\createalertbox{mdalerttip}{alertTipBg}{alertTipBorder}{TIP}
\createalertbox{mdalertimportant}{alertImportantBg}{alertImportantBorder}{IMPORTANT}
\createalertbox{mdalertwarning}{alertWarningBg}{alertWarningBorder}{WARNING}
\createalertbox{mdalertcaution}{alertCautionBg}{alertCautionBorder}{CAUTION}

% Create container environments (truly transparent alignment)
\newenvironment{mdcenter}{
\begin{center}}{
\end{center}}

\newenvironment{mdright}{
\begin{flushright}}{
\end{flushright}}

% Box environment with complete border and transparent background using tcolorbox
\newtcolorbox{mdbox}{
  enhanced,
  breakable,
  frame hidden,
  interior hidden,
  borderline={1pt}{0pt}{boxBorder},
  left=10pt,
  right=10pt,
  top=8pt,
  bottom=8pt,
  boxsep=0pt,
  sharp corners
}

\newtcbox{\kbdkeybox}{
  enhanced,
  on line,
  arc=2pt,
  colback=keyBg,
  colframe=keyBorder,
  boxrule=0.5pt,
  left=3pt,
  right=3pt,
  top=2pt,
  bottom=2pt,
  boxsep=0pt,
  before upper={\small\ttfamily},
  shadow={0mm}{-0.5mm}{0mm}{keyBorder},
  width=0.9\textwidth
}

% ============================================================
% CUSTOM COMMANDS
% ============================================================

\newcommand{\kbdkey}[1]{\kbdkeybox{#1}}
\newcommand{\kbdplus}{\,{\small +}\,}
\newcommand{\kbdshortcut}[1]{#1}

% Unified code block wrapper
% #1 = file path to input
% #2 = language (can be empty for plain text)
% #3 = top padding (5pt or 20pt)
% #4 = whether to show overlay label (true/false)
% #5 = extra minted options (e.g., highlightlines)
\newcommand{\codeblock}[5]{
  \begin{tcolorbox}[
      enhanced,
      colback=black!3,
      colframe=black!10,
      boxrule=0.5pt,
      arc=3pt,
      left=5pt,
      right=5pt,
      top=#3,
      bottom=5pt,
      breakable,
      overlay={
        \ifstrequal{#4}{true}{
          \node[anchor=north east, font=\scriptsize\ttfamily, text=black!50, fill=black!7, rounded corners=1pt]
          at ([xshift=-5pt,yshift=-5pt]frame.north east) {#2};
        }{}
      }
    ]

    % if #2 contains terminal, replace it with text
    \edef\templang{#2}
    % Terminal mode
    \ifx\templang\terminallang
    {
      \def\FancyVerbFormatLine##1{\ifnum\value{FancyVerbLine}=1{\color{terminalCommandFg}##1}\else##1\fi}
      \inputminted[breaklines=true,linenos=false,highlightcolor=codeHighlightBg]{text}{#1}
    }
    \else
    % Plain text mode (no language specified)
    \edef\templang{#2}
    \ifx\templang\empty
    \inputminted[breaklines=true,linenos=false]{text}{#1}
    \else
    % Language-specific mode with optional extra options
    \def\extraopts{#5}
    \ifx\extraopts\empty
    \inputminted[breaklines=true,linenos=false,highlightcolor=codeHighlightBg]{#2}{#1}
    \else
    % With extra options
    \inputminted[breaklines=true,linenos=false,highlightcolor=codeHighlightBg,#5]{#2}{#1}
    \fi
    \fi
    \fi
  \end{tcolorbox}
}

\newcommand{\mdcheckboxchecked}{
  \tikz[baseline=0.2ex]{\draw[line width=0.5pt,rounded corners=1pt] (0,0) rectangle (1.8ex,1.8ex); \draw[line width=1.4pt] (0.3ex,0.9ex) to (0.7ex,0.5ex) to (1.5ex,1.3ex);}
  \hspace{0.4em}
}
\newcommand{\mdcheckboxunchecked}{
  \tikz[baseline=0.2ex]{\draw[line width=0.5pt,rounded corners=1pt] (0,0) rectangle (1.8ex,1.8ex);}
  \hspace{0.4em}
}
\newcommand{\mdcheckboxpartial}{
  \tikz[baseline=0.2ex]{\draw[line width=0.5pt,rounded corners=1pt] (0,0) rectangle (1.8ex,1.8ex); \fill[black] (0.4ex,0.4ex) rectangle (1.4ex,1.4ex);}
  \hspace{0.4em}
}

\newcommand{\creditblock}{
  \begin{center}
    \includegraphics[width=2.5cm]{credit-sign.pdf}\par
    \footnotesize
    \LaTeX{} Document by abd, more @ \href{https://github.com/abdxdev/notes-maker}{github.com/abdxdev/notes-maker} \\
    Report errors: \href{mailto:abdulrahman.abd.dev@gmail.com?subject=Report for \assignmenttitle\%20- \assignmentsubtitle&body=I want to talk about \assignmenttitle\%20- \assignmentsubtitle}{abdulrahman.abd.dev@gmail.com} | \href{https://wa.me/923124996133?text=I want to talk about \assignmenttitle\%20- \assignmentsubtitle}{+92 312 4996133} \\
    \color{gray}\textit{Compiled on: \today\ at \currenttime}
  \end{center}
}

\renewcommand{\markdownRendererTickedBox}{\mdcheckboxchecked}
\renewcommand{\markdownRendererUntickedBox}{\mdcheckboxunchecked}
\renewcommand{\markdownRendererHalfTickedBox}{\mdcheckboxpartial}

\markdownSetup{
  rendererPrototypes={
    codeSpan = {\inlinecode{#1}},
    link = {\href{#3}{#1}},
    blockQuoteBegin = {
    \begin{mdblockquote}},
      blockQuoteEnd = {
    \end{mdblockquote}},
    inlineHtmlTag = {
      \ifstrequal{#1}{<br>}{\newline\noindent}{
        \ifstrequal{#1}{<br/>}{\newline\noindent}{
          \ifstrequal{#1}{<br />}{\newline\noindent}{#1}
        }
      }
    },
    strikeThrough = {\mdstrikethrough{#1}},
    superscript = {\textsuperscript{#1}},
    subscript = {\textsubscript{#1}},
    image = {
      \begin{figure}[H]
        \centering
        \includegraphics[width=\textwidth,height=0.5\textheight,keepaspectratio]{#3}
        \ifx\empty#4\empty\else\caption{#4}\fi
      \end{figure}
    },
    inputFencedCode = {
      \edef\templang{#3}
      \ifx\templang\empty
      \codeblock{#1}{}{5pt}{false}{}
      \else
      \def\terminallang{terminal}
      \ifx\templang\terminallang
      \codeblock{#1}{terminal}{20pt}{true}{}
      \else
      \codeblock{#1}{#3}{20pt}{true}{}
      \fi
      \fi
    },
    inputVerbatim = {
      \codeblock{#1}{}{5pt}{false}{}
    },
    dlBegin = {
    \begin{description}},
        dlEnd = {
    \end{description}},
    dlItem = {
    \item[#1]\mbox{}\newline
    },
    dlItemEnd = {},
    thematicBreak = {
      \begin{center}
        {\color{footnoteRuleColor}\rule{\textwidth}{0.3pt}}
      \end{center}
      \vspace{0.5em}
    },
  },
  fencedCode = true,
}

\setmonofont{JetBrainsMonoNL}[
  Path=fonts/,
  Extension=.ttf,
  UprightFont=*-Regular,
  BoldFont=*-Bold,
  ItalicFont=*-Italic,
  BoldItalicFont=*-BoldItalic,
]

\hypersetup{
  colorlinks=true,
  linkcolor=black,
  filecolor=magenta,
  urlcolor=cyan
}

\newcommand{\university}{@@UNIVERSITY@@}
\newcommand{\department}{@@DEPARTMENT@@}
\newcommand{\assignmenttitle}{@@TITLE@@}
\newcommand{\assignmentsubtitle}{@@SUBTITLE@@}
\newcommand{\submittedto}{@@SUBMITTEDTO@@}
\newcommand{\submissioninfo}[1]{
  \begin{tabular}{@{}ll@{}}
    #1
  \end{tabular}
}

% Title Template Settings
% 0 = No title (disabled)
% 1 = Full university title page with logo (default)
% 2 = Modern title header inline with content (no separate page)
% 3 = Modern title on separate page (same design as mode 2, but centered on its own page)
\newcommand{\titleTemplate}{1}
@@TITLE_TEMPLATE@@

\newif\ifenablecontentpage
\enablecontentpagetrue

@@ENABLE_CONTENT_PAGE@@

\newif\ifenablepagecredits
\enablepagecreditstrue

@@ENABLE_PAGE_CREDITS@@

\newif\ifenablefootnotesatend
\enablefootnotesatendfalse

@@ENABLE_FOOTNOTES_AT_END@@

\newif\ifenablefootnotesascomments
\enablefootnotesascommentsfalse

@@ENABLE_FOOTNOTES_AS_COMMENTS@@

\newif\ifenablethatsall
\enablethatsalltrue

@@ENABLE_THATS_ALL_PAGE@@

\ifenablefootnotesatend

\let\footnote=\endnote
\renewcommand{\notesname}{References}

\makeatletter
\renewcommand{\enoteformat}{
  \noindent
  \makebox[2em][l]{\@theenmark.}\hspace{0.3em}
}    \makeatother

\renewcommand{\enoteheading}{
  \thispagestyle{empty}
  \begin{center}
    {\Huge\bfseries\color{black}\notesname}
  \end{center}
  \vspace{\cftaftertoctitleskip}
}

\renewcommand{\enotesize}{\normalsize}

\def\enotesize{\normalsize}
\patchcmd{\theendnotes}{\par}{\par\vspace{0.8em}}{}{}
\else

\makeatletter

\renewcommand{\footnoterule}{
  \vspace{0.5em}
  \noindent
  {\color{footnoteRuleColor}\rule{\textwidth}{0.3pt}}
  \vspace{0.5em}
}

\renewcommand{\@makefnmark}{
  \hbox{\normalfont\small\color{footnoteNumColor}[\@thefnmark]}
}

\renewcommand{\@makefntext}[1]{
  \parindent 1.5em
  \makebox[0pt][r]{
    {\normalfont\small\color{footnoteNumColor}[\@thefnmark]}
  }
  {\footnotesize#1}
  \vspace{0.5em}
}

\renewcommand{\footnotesize}{\fontsize{9}{11}\selectfont}
\makeatother
\fi

\renewcommand{\cfttoctitlefont}{\Huge\bfseries\color{black}}
\renewcommand{\cftbeforetoctitleskip}{20pt}
\renewcommand{\cftaftertoctitleskip}{30pt}
\renewcommand{\cftsecfont}{\Large\bfseries\color{black}}
\renewcommand{\cftsubsecfont}{\large\color{black}}
\renewcommand{\cftsubsubsecfont}{\normalsize\color{black}}
\renewcommand{\cftsecpagefont}{\Large\color{black}}
\renewcommand{\cftsubsecpagefont}{\large\color{black}}
\renewcommand{\cftsubsubsecpagefont}{\normalsize\color{black}}
\renewcommand{\cftsecleader}{\hspace{1em}}
\renewcommand{\cftsubsecleader}{\hspace{1em}}
\renewcommand{\cftsubsubsecleader}{\hspace{1em}}
\setlength{\cftbeforesecskip}{15pt}
\setlength{\cftbeforesubsecskip}{8pt}
\setlength{\cftbeforesubsubsecskip}{5pt}

\titlecontents{section}[2em]
{\addvspace{1.2pc}\large\bfseries\color{black}}
{\contentslabel[\thecontentslabel]{2em}}
{}
{\hfill\thecontentspage}[\vspace{0.5pc}]

\titlecontents{subsection}[4em]
{\addvspace{0.8pc}\normalsize\color{black}}
{\contentslabel[\thecontentslabel]{2.5em}}
{}
{\hfill\thecontentspage}

\titlecontents{subsubsection}[6em]
{\addvspace{0.5pc}\small\color{black}}
{\contentslabel[\thecontentslabel]{3em}}
{}
{\hfill\thecontentspage}

\renewcommand{\contentsname}{
  \vspace{-20pt}
  \centerline{\Huge\bfseries\color{black}{Contents}}
  \vspace{10pt}
  \centerline{\rule{0.5\textwidth}{1pt}}
  \vspace{15pt}
}

\renewcommand{\maketitle}{
  \begin{titlepage}
    \centering
    \vspace*{-1cm}

    \includegraphics[width=3cm]{uni-logo.pdf}\par
    \vspace{0.5cm}
    {\large\scshape \university\par}
    {\normalsize\scshape \department\par}
    \vspace{1.5cm}
    {\LARGE\bfseries \assignmenttitle\par}
    \vspace{0.3cm}
    {\color{gray}\rule{0.6\textwidth}{0.4pt}\par}
    \vspace{0.5cm}
    {\large{\assignmentsubtitle}\par}
    \vfill
    {
      \large
      \textbf{Submitted By}\par
      \vspace{0.3cm}
      \submissioninfo{
        @@AUTHORS@@
      }
    }
    \vfill
    {
      \large
      \textbf{Submitted To}\par
      \vspace{0.3cm}
      \submittedto\par
    }
    \vfill
    {\large @@DATE@@\par}
  \end{titlepage}
  \clearpage
}

\titleformat{\section}
{\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}
{\large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}
{\normalsize\bfseries}{\thesubsubsection}{1em}{}
\titleformat{\paragraph}
{\normalsize\bfseries}{\theparagraph}{1em}{}
\titleformat{\subparagraph}
{\small\bfseries}{\thesubparagraph}{1em}{}

\titlespacing*{\section}
{0pt}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}
\titlespacing*{\subsection}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\titlespacing*{\subsubsection}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1em}
\titlespacing*{\subparagraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1em}

\begin{document}

% Title Template Rendering
\ifnum\titleTemplate=1
% Mode 1: Full university title page with logo
\thispagestyle{empty}
\maketitle
\fi

\ifnum\titleTemplate=2
% Mode 2: Modern title header above content
\thispagestyle{empty}
\begin{center}
  \vspace*{1cm}
  % Main title with gradient-like effect using shadow
  \begin{tcolorbox}[
      enhanced,
      colback=titleBoxBg,
      colframe=titleBoxFrame,
      boxrule=1pt,
      arc=8pt,
      left=20pt,
      right=20pt,
      top=25pt,
      bottom=25pt,
      shadow={2mm}{-2mm}{0mm}{titleBoxFrame},
      width=0.9\textwidth
    ]
    \centering
    {\fontsize{36}{40}\selectfont\bfseries\color{titleMainText}\assignmenttitle\par}
    \vspace{0.4cm}
    {\fontsize{16}{20}\selectfont\color{titleSubText}\assignmentsubtitle\par}
  \end{tcolorbox}

  \vspace{1cm}
\end{center}
\fi

\ifnum\titleTemplate=3
\thispagestyle{empty}
\begin{center}
  \vspace*{1cm}
  \begin{tcolorbox}[
      enhanced,
      colback=titleBoxBg,
      colframe=titleBoxFrame,
      boxrule=1pt,
      arc=8pt,
      left=20pt,
      right=20pt,
      top=25pt,
      bottom=25pt,
      shadow={2mm}{-2mm}{0mm}{titleBoxFrame},
      width=0.9\textwidth
    ]
    \centering
    {\fontsize{36}{40}\selectfont\bfseries\color{titleMainText}\assignmenttitle\par}
    \vspace{0.4cm}
    {\fontsize{16}{20}\selectfont\color{titleSubText}\assignmentsubtitle\par}
  \end{tcolorbox}
\end{center}
\vspace*{\fill}
\ifenablepagecredits
\vfill
\creditblock
\fi

\clearpage
\fi

\ifenablecontentpage
\renewcommand{\contentsname}{\centerline{Contents}}
@@TOC_DEPTH@@
\tableofcontents
\thispagestyle{empty}
\clearpage
\fi

\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO,RE]{\leftmark}
\renewcommand{\sectionmark}[1]{\markboth{\thesection\ #1}{}}
\renewcommand{\subsectionmark}[1]{}

\pagestyle{fancy}

\raggedbottom

\AtBeginEnvironment{tabular}{
\begin{adjustbox}{max width=\textwidth}}
  \AtEndEnvironment{tabular}{
\end{adjustbox}}

\let\oldincludegraphics\includegraphics
\renewcommand{\includegraphics}[2][]{\oldincludegraphics[width=\textwidth,height=0.5\textheight,keepaspectratio,#1]{#2}}

\makeatletter
\renewcommand{\fps@table}{H}
\makeatother

\markdownInput{@@INPUT_FILE@@}

\ifenablefootnotesatend
\clearpage
\theendnotes
\fi

\ifenablethatsall
\clearpage
\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
  {\Huge\bfseries --- That's all for now ---}
\end{center}
\vspace*{\fill}
\fi
\ifnum\titleTemplate=3\else
\ifenablepagecredits
\vfill
\creditblock
\fi
\fi

\end{document}
